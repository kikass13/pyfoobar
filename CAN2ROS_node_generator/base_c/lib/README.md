
# AUTOGENERATED PACKAGE
from: http://gitlab_al.streetscooter.eu/al_SW_Team/CAN2ROS_node_generator


## <>AUTO_INSERT:PACKAGE_NAME<> - CAN Interface Library

### Usage
For vehicle type B16 (e.g. Messfahrzeug) use branch "B16".

can_interface bridges CAN messages to ROS topics. Currently there are two messages published, more can be added if required.

Required steps to use interface:

1. To use CAN dongle, the device must be installed as ethernet device ("SocketCAN").
2. sudo ip link set can0 up type can bitrate 500000
3. sudo ifconfig can0 up
4. include library and link against it in another node
   1. CmakeLists.txt 
   ```find_package(catkin REQUIRED COMPONENTS <>AUTO_INSERT:PACKAGE_NAME<>)```
   ```catkin_package( ... CATKIN_DEPENDS <>AUTO_INSERT:PACKAGE_NAME<>)```
   2. package.xml
   ```<depend><>AUTO_INSERT:PACKAGE_NAME<></depend>```

5. use library api to register callbacks and send ros messages back to can
   1. .h include package
   ```#include <<>AUTO_INSERT:PACKAGE_NAME<>/can_interface.h>```
   2. .h declare interface object
   ```<>AUTO_INSERT:PACKAGE_NAME<>::CanInterface canIf_;```
   3. .h declare our local (user) callback functions for receiving messages via CAN
   //<>AUTO_INSERT:DO_PER_MESSAGE<> <R> ```void cb_<>AUTO_INSERT:PACKAGE_NS<>_<>AUTO_INSERT:MESSAGE_NAME<>(const <>AUTO_INSERT:PACKAGE_NAME<>::<>AUTO_INSERT:MESSAGE_NAME<>& msg);```
   4. .cpp define already declared local (user) callback functions for receiving messages via CAN [PLEASE CHANGE 'RosPackageTemplate' TO YOUR CLASS NAME !!!]
   //<>AUTO_INSERT:DO_PER_MESSAGE<> <R> ```void RosPackageTemplate::cb_<>AUTO_INSERT:PACKAGE_NS<>_<>AUTO_INSERT:MESSAGE_NAME<>(const <>AUTO_INSERT:PACKAGE_NAME<>::<>AUTO_INSERT:MESSAGE_NAME<>& msg){}```
   5. .cpp initialize the interface object somewhere
   ```this->canIf_.initialize("can1");```
   6. .cpp register your local (user) callback functions for receiving messages via CAN [PLEASE CHANGE 'RosPackageTemplate' TO YOUR CLASS NAME !!!]
   //<>AUTO_INSERT:DO_PER_MESSAGE<> <R> ```this->canIf_.register_<>AUTO_INSERT:PACKAGE_NS<>_<>AUTO_INSERT:MESSAGE_NAME<>_callback(std::bind(&RosPackageTemplate::cb_<>AUTO_INSERT:PACKAGE_NS<>_<>AUTO_INSERT:MESSAGE_NAME<>, this, std::placeholders::_1));```
   7. [OPTIONAL] .cpp you can send messages by calling their respective send functions [THIS EXAMPLE USES THE MESSAGE's DEFAULT CONSTRUCTOR, DO NOT DO THIS IN REAL NODES !!!]
   //<>AUTO_INSERT:DO_PER_MESSAGE<> <W>```this->canIf_.send_<>AUTO_INSERT:PACKAGE_NS<>_<>AUTO_INSERT:MESSAGE_NAME<>(<>AUTO_INSERT:PACKAGE_NAME<>::<>AUTO_INSERT:MESSAGE_NAME<>());```

### Test

prepare a virtual can device and install utilities

```
sudo apt-get install can-utils
sudo modprobe vcan
sudo ip link add dev vcan0 type vcan
sudo ip link set up vcan0     
```

write your node, include the library and start the interface to read/write something to/from the interface like this

```
candump vcan0
cansend vcan0 110#11
```

### Auto Generated .dbc Message Information

#### Read (CAN to User) 
//<>AUTO_INSERT:DO_PER_MESSAGE<> <R> * <>AUTO_INSERT:PACKAGE_NS<>::<>AUTO_INSERT:MESSAGE_NAME<>

#### Write (User to CAN)
//<>AUTO_INSERT:DO_PER_MESSAGE<> <W> * <>AUTO_INSERT:PACKAGE_NS<>::<>AUTO_INSERT:MESSAGE_NAME<>
